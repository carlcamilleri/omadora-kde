# Create a gum stub function that works without gum
gum() {
  local cmd="$1"
  shift

  case "$cmd" in
    style)
      # Parse style arguments and just output the text
      local text=""
      while [[ $# -gt 0 ]]; do
        case "$1" in
          --foreground|--background|--padding|--border|--align|--width|--height)
            shift 2  # Skip flag and value
            ;;
          --*)
            shift  # Skip other flags
            ;;
          *)
            text="$1"
            shift
            ;;
        esac
      done
      echo "$text"
      ;;
    choose)
      # Extract options (non-flag arguments)
      local options=()
      while [[ $# -gt 0 ]]; do
        case "$1" in
          --header|--height|--padding)
            shift 2
            ;;
          --*)
            shift
            ;;
          *)
            options+=("$1")
            shift
            ;;
        esac
      done
      # Return first option
      echo "${options[0]}"
      ;;
    confirm)
      # Simple yes/no - default to yes
      echo "yes"
      ;;
    input)
      # Skip for now
      ;;
    log)
      shift  # Skip --level
      echo "$@"
      ;;
    *)
      echo "$@"
      ;;
  esac
}
export -f gum

# Get terminal size from /dev/tty (works in all scenarios: direct, sourced, or piped)
if [ -e /dev/tty ]; then
  TERM_SIZE=$(stty size 2>/dev/null </dev/tty)

  if [ -n "$TERM_SIZE" ]; then
    export TERM_HEIGHT=$(echo "$TERM_SIZE" | cut -d' ' -f1)
    export TERM_WIDTH=$(echo "$TERM_SIZE" | cut -d' ' -f2)
  else
    # Fallback to reasonable defaults if stty fails
    export TERM_WIDTH=80
    export TERM_HEIGHT=24
  fi
else
  # No terminal available (e.g., non-interactive environment)
  export TERM_WIDTH=80
  export TERM_HEIGHT=24
fi

export LOGO_PATH="$OMADORA_PATH/logo.txt"
export LOGO_WIDTH=$(awk '{ if (length > max) max = length } END { print max+0 }' "$LOGO_PATH" 2>/dev/null || echo 0)
export LOGO_HEIGHT=$(wc -l <"$LOGO_PATH" 2>/dev/null || echo 0)

export PADDING_LEFT=$((($TERM_WIDTH - $LOGO_WIDTH) / 2))
export PADDING_LEFT_SPACES=$(printf "%*s" $PADDING_LEFT "")

# Theme colors for gum confirm (KDE Breeze inspired)
export GUM_CONFIRM_PROMPT_FOREGROUND="6"     # Cyan for prompt
export GUM_CONFIRM_SELECTED_FOREGROUND="0"   # Black text on selected
export GUM_CONFIRM_SELECTED_BACKGROUND="4"   # Blue background for selected (KDE blue)
export GUM_CONFIRM_UNSELECTED_FOREGROUND="7" # White for unselected
export GUM_CONFIRM_UNSELECTED_BACKGROUND="0" # Black background for unselected
export PADDING="0 0 0 $PADDING_LEFT"         # Gum Style
export GUM_CHOOSE_PADDING="$PADDING"
export GUM_FILTER_PADDING="$PADDING"
export GUM_INPUT_PADDING="$PADDING"
export GUM_SPIN_PADDING="$PADDING"
export GUM_TABLE_PADDING="$PADDING"
export GUM_CONFIRM_PADDING="$PADDING"

clear_logo() {
  printf "\033[H\033[2J" # Clear screen and move cursor to top-left
  if [ -f "$LOGO_PATH" ]; then
    echo ""
    cat "$LOGO_PATH"
    echo ""
  else
    echo "Omadora KDE"
  fi
}
