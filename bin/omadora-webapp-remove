#!/bin/bash

set -e

APP_NAME="$1"

if [[ -z "$APP_NAME" ]]; then
  echo "Usage: omadora-webapp-remove <app-name>"
  exit 1
fi

DESKTOP_FILE="$HOME/.local/share/applications/$APP_NAME.desktop"
ICON_DIR="$HOME/.local/share/applications/icons"

# Remove .desktop file
if [[ -f "$DESKTOP_FILE" ]]; then
  rm "$DESKTOP_FILE"
  echo "Removed $APP_NAME.desktop"
else
  echo "Warning: $DESKTOP_FILE not found"
fi

# Remove icon if exists
if [[ -f "$ICON_DIR/$APP_NAME.png" ]]; then
  rm "$ICON_DIR/$APP_NAME.png"
  echo "Removed icon"
fi

# Update KDE's application cache
if command -v kbuildsycoca5 &>/dev/null; then
  kbuildsycoca5 &>/dev/null
elif command -v kbuildsycoca6 &>/dev/null; then
  kbuildsycoca6 &>/dev/null
fi

echo "$APP_NAME removed"
